REM SNOWFALL
USEGRAPHIC 9
USEVAR MAXNUM,MAXW,MAXH,ORGX#,ORGD#,WAVEW#,SPEED#,OLDX,OLDY
MAXNUM=20
DIM ORGX#(MAXNUM),ORGD#(MAXNUM),Y#(MAXNUM),WAVEW#(MAXNUM),SPEED#(MAXNUM),OLDX(MAXNUM),OLDY(MAXNUM)
MAXW=SYSTEM(22):MAXH=SYSTEM(23)
FOR I=0 TO MAXNUM-1
  Y#(I)=FLOAT#(RND()*MAXH/32767)
  GOSUB SETREG
NEXT
I=0
DO
  IF Y#(I)=0 THEN
    GOSUB SETREG
  ENDIF
  X#=Y#(I)/128*PI#
  IF SPEED#(I) < 0.9 THEN
    T=1
  ELSE
    T=2 
  ENDIF
  PUTBMP OLDX(I),OLDY(I),T,T,BMP0
  OLDX(I)=INT(SIN#(X#+ORGD#(I))*WAVEW#(I)+ORGX#(I))
  OLDY(I)=INT(Y#(I))
  PUTBMP OLDX(I),OLDY(I),T,T,BMP1
  IF INKEY()!=0 THEN BREAK
  Y#(I)=Y#(I)+SPEED#(I)
  IF INT(Y#(I))>=MAXH THEN
    PUTBMP OLDX(I),OLDY(I),T,T,BMP0
    Y#(I)=0
  ENDIF
  I=I+1
  IF I>=MAXNUM THEN
    I=0
  ENDIF
LOOP WHILE INKEY()=0
END

LABEL SETREG
SPEED#(I)=FLOAT#(10-RND()%5)/10
ORGX#(I)=FLOAT#(RND()*MAXW/32767)
ORGD#(I)=FLOAT#(RND()*360/32767)
WAVEW#(I)=FLOAT#(RND()*20/32767)*SPEED#(I)
RETURN

LABEL BMP0
CDATA 8,8,8,8

LABEL BMP1
CDATA 7,7,7,7