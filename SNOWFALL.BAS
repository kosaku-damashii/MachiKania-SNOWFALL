REM SNOWFALL
USEGRAPHIC 9
USEVAR MAXNUM,MAXW,MAXH,ORGX,ORGD,WAVEW,SPEED,OLDX,OLDY
MAXNUM=100
DIM ORGX#(MAXNUM),ORGD#(MAXNUM),Y#(MAXNUM),WAVEW#(MAXNUM),SPEED#(MAXNUM),OLDX(MAXNUM),OLDY(MAXNUM),G(1),B(1)
B(0)=0x08080808
MAXW=SYSTEM(22):MAXH=SYSTEM(23)
FOR I=0 TO MAXNUM-1
  Y#(I)=FLOAT#(RND()*MAXH/32767)
  GOSUB SETREG
NEXT

REM Merry Chrismas,Mr.Lawrence
MUSIC "Q:1/4=90"
MUSIC "L:1/8"
MUSIC "K:C"
N=0

DO
  FOR I=0 TO MAXNUM-1
    IF Y#(I)=0 THEN
      GOSUB SETREG
    ENDIF
    X#=Y#(I)/128*PI#
    IF SPEED#(I) < 0.7 THEN
      T=1:G(0)=0x0F0F0F0F
    ELSEIF SPEED#(I) < 0.9 THEN
      T=2:G(0)=0x0F0F0F0F
    ELSE
      T=2:G(0)=0x07070707
    ENDIF
    PUTBMP OLDX(I),OLDY(I),T,T,B
    OLDX(I)=INT(SIN#(X#+ORGD#(I))*WAVEW#(I)+ORGX#(I))
    OLDY(I)=INT(Y#(I))
    PUTBMP OLDX(I),OLDY(I),T,T,G
    IF INKEY()!=0 THEN BREAK
    Y#(I)=Y#(I)+SPEED#(I)*4
    IF INT(Y#(I))>=MAXH THEN
      PUTBMP OLDX(I),OLDY(I),T,T,B
      Y#(I)=0
    ENDIF
    IF 1>=MUSIC() THEN 
      GOSUB 10000+N
      N=N+1
      IF N>7 THEN
        N=0
      ENDIF
    ENDIF
  NEXT
LOOP WHILE INKEY()=0
END

LABEL SETREG
SPEED#(I)=FLOAT#(10-RND()%5)/10
ORGX#(I)=FLOAT#(RND()*MAXW/32767)
ORGD#(I)=FLOAT#(RND()*360/32767)
WAVEW#(I)=FLOAT#(RND()*20/32767)*SPEED#(I)
RETURN

10000 MUSIC "AGAD'AGAGAD'AG":RETURN
10001 MUSIC "AGAC'AGAGAC'AG":RETURN
10002 MUSIC "GFGC'GFGFGC'GF":RETURN
10003 MUSIC "GFGC'GFEDEAED":RETURN
10004 MUSIC "AGAD'AGAGAD'AG":RETURN
10005 MUSIC "AGAC'AGAGAC'AG":RETURN
10006 MUSIC "GFGE'GFC'GFE'GF":RETURN
10007 MUSIC "GFGE'GFC'GFE'GF":RETURN